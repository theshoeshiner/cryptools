import Sortable from 'sortablejs';

window.Vaadin.Flow.sortableConnector = {
    initLazy: function (customConfig, c, layout) {
        // Check whether the connector was already initialized
        if (c.$connector) {
            return;
        }

        c.$connector = {
            //// functions
            setOption : function(optionName, optionValue) {
                this.sortable.options[optionName] = optionValue;
            }
        };

        c.$connector.sortable = Sortable.create(layout, customConfig);

        c.$connector.sortable.options.onEnd = function (/**Event*/evt) {
            var itemEl = evt.item;  // dragged HTMLElement
            evt.to;    // target list
            evt.from;  // previous list
            evt.oldIndex;  // element's old index within old parent
            evt.newIndex;  // element's new index within new parent
            evt.oldDraggableIndex; // element's old index within old parent, only counting draggable elements
            evt.newDraggableIndex; // element's new index within new parent, only counting draggable elements
            evt.clone; // the clone element
            evt.pullMode;  // when item is in another sortable: `"clone"` if cloning, `true` if moving
            if (evt.to === evt.from) {
                c.$server.onReorderListener(evt.oldIndex, evt.newIndex);
            } else {
                var clone = (evt.pullMode == 'clone');
                evt.from.parentElement.$server.onRemoveListener(evt.oldIndex, clone);
                evt.to.parentElement.$server.onAddListener(evt.newIndex, clone);
                if (clone) {
                    // remove the clone generated by the client-side
                    evt.clone.parentNode.removeChild(evt.clone);
                }
            }
        }

    }
}